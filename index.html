<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Driver Waiting Checker</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 100%;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    tbody tr:nth-child(odd) {
      background-color: #fafafa;
    }

    input[type="text"] {
      width: 100%;
      min-width: 100px;
      padding: 4px;
    }

    input[type="time"] {
      padding: 4px;
    }

    select {
      padding: 4px;
      width: 100%;
    }

    button {
      padding: 15px;
      margin: 5px 5px 0 0;
      border: none;
      background-color: #007BFF;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    button.remove {
      background-color: #dc3545;
      padding: 6px 10px;
    }

    button.remove:hover {
      background-color: #c82333;
    }

    .result-panel {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 6px;
      background-color: #f9f9f9;
      flex: 1;
      min-width: 400px;
      max-width: 500px;
      word-break: break-word;
    }

    .result-panel ul {
      padding-left: 20px;
    }

    .result-panel li {
      margin-bottom: 8px;
    }

    .actions {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .btn-check {
      background-color: #28a745;
      padding: 15px;
      color: white;
      margin-right: 0;
    }

    .btn-check:hover {
      background-color: #218838;
    }

    @media (max-width: 800px) {
      body {
        flex-direction: column;
      }

      .result-panel {
        max-width: 100%;
        width: 100%;
      }

      td input[type="text"]:nth-child(3) {
        width: 100%;
      }

      button {
        width: auto;
      }
    }
  </style>

</head>

<body>

  <div>
    <h3>Ride Plan</h3>
    <table id="rideTable">
      <thead>
        <tr>
          <th>Time</th>
          <th>Action</th>
          <th>Address pick-up/drop-off</th>
          <th>Passenger</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="time" value="14:00"></td>
          <td>
            <select>
              <option value="Pickup">Pickup</option>
              <option value="Dropoff">Dropoff</option>
            </select>
          </td>
          <td><input type="text" value="Rua de Oliveira Monteiro 107"></td>
          <td><input type="text" value="Martin"></td>
          <td><button class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
        <tr>
          <td><input type="time" value="14:05"></td>
          <td>
            <select>
              <option value="Pickup">Pickup</option>
              <option value="Dropoff">Dropoff</option>
            </select>
          </td>
          <td><input type="text" value="Rua de Oliveira Monteiro 200"></td>
          <td><input type="text" value="Selena"></td>
          <td><button class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
        <tr>
          <td><input type="time" value="14:35"></td>
          <td>
            <select>
              <option value="Dropoff">Dropoff</option>
              <option value="Pickup">Pickup</option>
            </select>
          </td>
          <td><input type="text" value="R. de Alves Redol 292, 4050-042 Porto, Portugal"></td>
          <td><input type="text" value="Martin"></td>
          <td><button class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
        <tr>
          <td><input type="time" value="14:40"></td>
          <td>
            <select>
              <option value="Dropoff">Dropoff</option>
              <option value="Pickup">Pickup</option>
            </select>
          </td>
          <td><input type="text" value="R. de Alves Redol 292, 4050-042 Porto, Portugal"></td>
          <td><input type="text" value="Selena"></td>
          <td><button class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
        <tr>
          <td><input type="time" value="16:00"></td>
          <td>
            <select>
              <option value="Pickup">Pickup</option>
              <option value="Dropoff">Dropoff</option>
            </select>
          </td>
          <td><input type="text" value="R. de Alves Redol 292, 4050-042 Porto, Portugal"></td>
          <td><input type="text" value="Selena"></td>
          <td><button class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
      </tbody>
    </table>
    <div class="actions">
      <button onclick="addRow()">Add Row + </button>
      <button class="btn-check" onclick="checkWaiting()">CHECK</button>
    </div>
  </div>

  <div class="result-panel">
    <h3>Driver Waiting Result</h3>
    <p>Driver is waiting for:</p>
    <ul id="resultList"></ul>
  </div>

  <script>
    function addRow() {
      const tbody = document.getElementById('rideTable').querySelector('tbody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="time"></td>
        <td>
          <select>
            <option value="Pickup">Pickup</option>
            <option value="Dropoff">Dropoff</option>
          </select>
        </td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><button class="remove" onclick="removeRow(this)">X</button></td>
      `;
      tbody.appendChild(row);
    }

    function removeRow(button) {
      button.closest('tr').remove();
    }

    function getDriverWaiting(events, maxWaitHours = 3) {
      const waitResults = [];
      const parseTime = (t) => new Date(`1970-01-01T${t}:00`);
      const dropoffs = events.filter(e => e.action === 'Dropoff');

      for (const dropEvent of dropoffs) {
        const { time, address: dropAddress, passenger: dropPassenger } = dropEvent;
        const dropTime = parseTime(time);
        const deadline = new Date(dropTime.getTime() + maxWaitHours * 60 * 60 * 1000);

        const futurePickups = events.filter(e =>
          e.action === 'Pickup' &&
          parseTime(e.time) > dropTime &&
          parseTime(e.time) <= deadline &&
          e.passenger === dropPassenger &&
          e.address === dropAddress
        );

        if (futurePickups.length === 0) continue;

        const pickupEvent = futurePickups[0];
        const pickupTime = parseTime(pickupEvent.time);

        const interimMoves = events.filter(e => {
          const eventTime = parseTime(e.time);
          return eventTime > dropTime && eventTime < pickupTime && e.address !== dropAddress;
        });

        if (interimMoves.length === 0) {
          const waitDurationHrs = (pickupTime - dropTime) / (1000 * 60 * 60);
          waitResults.push({
            passenger: dropPassenger,
            location: dropAddress,
            waitFrom: dropEvent.time,
            waitTo: pickupEvent.time,
            waitHours: waitDurationHrs.toFixed(2)
          });
        }
      }
      return waitResults;
    }

    function checkWaiting() {
      const rows = document.querySelectorAll('#rideTable tbody tr');
      const ridePlan = [];

      rows.forEach(row => {
        const inputs = row.querySelectorAll('input, select');
        const time = inputs[0].value;
        const action = inputs[1].value;
        const address = inputs[2].value.trim();
        const passenger = inputs[3].value.trim();

        if (time && action && address && passenger) {
          ridePlan.push({ time, action, address, passenger });
        }
      });

      const results = getDriverWaiting(ridePlan);
      const resultList = document.getElementById('resultList');
      resultList.innerHTML = '';

      results.forEach(r => {
        const li = document.createElement('li');
        li.textContent = `${r.passenger} waited at ${r.location} from ${r.waitFrom} to ${r.waitTo} (${r.waitHours} hrs)`;
        resultList.appendChild(li);
      });
    }
  </script>

</body>

</html>